<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0,user-scalable=no,minimum-scale=1.0,maximum=1.0">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="css/tai.css" />
</head>

<body>
    <div id="wrap">
        <div class="head">
            <div class="head-top">
                <!-- logo -->
                <h1 class="logo">
                    <a href="http://www.atguigu.com">
                        <img src="img/logo.png" />
                    </a>
                </h1>
                <!-- 面包屑导航 -->
                <a href="javascript:" class="menuBtn"></a>
                <!-- 按钮排 -->
                <div class="btns">
                    <a href="javascript:" class="search">搜素</a>
                    <a href="javascript:">登陆</a>
                    <a href="javascript:">注册</a>
                </div>
            </div>
            <div class="head-bottom">
                <form method="POST">
                    <input type="text" placeholder="请碰我一下" />
                    <input type="submit" value="搜索" />
                </form>
            </div>
            <ul class="mask">
                <li>
                    <a href="javascript:">首页</a>
                </li>
                <li>
                    <a href="javascript:">MV</a>
                </li>
                <li>
                    <a href="javascript:">悦单</a>
                </li>
                <li>
                    <a href="javascript:">V榜</a>
                </li>
                <li>
                    <a href="javascript:">音乐</a>
                </li>
                <li>
                    <a href="javascript:">商城</a>
                </li>
                <li>
                    <a href="javascript:">节目</a>
                </li>
                <li>
                    <a href="javascript:">饭团</a>
                </li>
                <li>
                    <a href="javascript:">咨询</a>
                </li>
                <li>
                    <a href="javascript:">我的家</a>
                </li>
                <li>
                    <a href="javascript:">APP下载</a>
                </li>
                <li>
                    <a href="javascript:">热门应用</a>
                </li>
            </ul>
        </div>
        <div class="content">
            <!-- 导航 -->
            <div class="damu-nav-drag-wrapper">
                <ul class="list">
                    <li class="active">
                        <a href="javascript:">首页</a>
                    </li>
                    <li>
                        <a href="javascript:">MV</a>
                    </li>
                    <li>
                        <a href="javascript:">悦单</a>
                    </li>
                    <li>
                        <a href="javascript:">V榜</a>
                    </li>
                    <li>
                        <a href="javascript:">音乐</a>
                    </li>
                    <li>
                        <a href="javascript:">商城</a>
                    </li>
                    <li>
                        <a href="javascript:">节目</a>
                    </li>
                    <li>
                        <a href="javascript:">饭团</a>
                    </li>
                    <li>
                        <a href="javascript:">咨询</a>
                    </li>
                    <li>
                        <a href="javascript:">我的家</a>
                    </li>
                    <li>
                        <a href="javascript:">APP下载</a>
                    </li>
                    <li>
                        <a href="javascript:">热门应用</a>
                    </li>
                    <li>
                        <a href="javascript:">晓飞张</a>
                    </li>
                    <li>
                        <a href="javascript:">金龙油</a>
                    </li>
                    <li>
                        <a href="javascript:">邱海峰</a>
                    </li>
                    <li>
                        <a href="javascript:">小贱贱</a>
                    </li>
                    <li>
                        <a href="javascript:">你</a>
                    </li>
                </ul>
            </div>
            <!-- 轮播 -->
            <div class="carousel-wrap" needAuto needCarousel>
                <div class="points-wrap"></div>
            </div>
            <!-- 选项卡 -->
            <div class="tab-wrap">
                <div class="tab-head">
                    <h2>MV主播</h2>
                    <span>更多&gt;</span>
                </div>
                <div class="tab-nav">
                    <a href="javascript:;">全部</a>
                    <a href="javascript:;">内地</a>
                    <a href="javascript:;">港台</a>
                    <a href="javascript:;">欧美</a>
                    <a href="javascript:;">韩国</a>
                    <a href="javascript:;">日本</a>
                    <div class="smallG"></div>
                </div>
                <div class="tab-content">
                    <ul class="tab-loading"></ul>
                    <ul>
                        <li>
                            <a href="javascript:;">
                                <img src="img/a.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tab-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/b.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tab-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/c.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tab-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/d.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tab-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/e.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tab-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/f.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tab-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="tab-loading"></ul>
                </div>
            </div>
            <!-- 选项卡 -->
            <div class="tab-wrap">
                <div class="tab-head">
                    <h2>MV主播</h2>
                    <span>更多&gt;</span>
                </div>
                <div class="tab-nav">
                    <a href="javascript:;">全部</a>
                    <a href="javascript:;">内地</a>
                    <a href="javascript:;">港台</a>
                    <a href="javascript:;">欧美</a>
                    <a href="javascript:;">韩国</a>
                    <a href="javascript:;">日本</a>
                    <div class="smallG"></div>
                </div>
                <div class="tab-content">
                    <ul class="tab-loading"></ul>
                    <ul>
                        <li>
                            <a href="javascript:;">
                                <img src="img/a.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tab-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/b.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tab-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/c.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tab-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/d.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tab-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/e.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tab-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="img/f.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tab-discuss">
                                <div class="right">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="left">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="tab-loading"></ul>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="js/tools.js"></script>
<script type="text/javascript" src="js/damu.js"></script>
<script type="text/javascript">
    window.onload = function () {
        document.addEventListener('touchstart', function (ev) {
            ev.preventDefault()
        }, { passive: false });
        (function () {
            var styleNode = document.createElement('style')
            var w = document.documentElement.clientWidth / 16
            styleNode.innerHTML = 'html{font-size:' + w + 'px!important}'
            document.head.appendChild(styleNode)
        })();

        tab();
        // 选项卡
        function tab() {
            var wrap = document.querySelector("#wrap .content .tab-wrap");
            var w = wrap.offsetWidth;
            var contentNodes = document.querySelectorAll("#wrap .content .tab-wrap .tab-content");
            // var loadings = document.querySelectorAll("#wrap .content .tab-wrap .tab-content .tab-loading");
            for (let i = 0; i < contentNodes.length; i++) {
                move(contentNodes[i]);
            }

            function move(content) {
                damu.css(content, "translateX", -w);
                // 加载时的图标
                var loadings = content.querySelectorAll(".tab-loading");
                // 小绿
                var smallG=document.querySelector("#wrap .content .tab-wrap .tab-nav .smallG");
                // 小绿的小标
                var now=0;
                // 导航菜单
                var aNodes=document.querySelectorAll("#wrap .content .tab-wrap .tab-nav a");
                var startPoint = { x: 0, y: 0 };
                var elementPoint = { x: 0, y: 0 };
                var isX = true;
                var isFirst = true;
                // 是否过1/2，停止拖动，并跳转
                var isOver = false;
                content.addEventListener("touchstart", function (ev) {
                    var touchC = ev.changedTouches[0];
                    startPoint.x = touchC.clientX;
                    startPoint.y = touchC.clientY;
                    elementPoint.x = damu.css(content, "translateX");
                    elementPoint.y = damu.css(content, "translateY");
                    isX = true;
                    isFirst = true;
                    // 清除过渡
                    content.style.transition = "none";
                    isOver = false;
                });
                content.addEventListener("touchmove", function (ev) {
                    if (isOver) {
                        return;
                    }
                    if (!isX) {
                        return;
                    }
                    var touchC = ev.changedTouches[0];
                    var nowPoint = { x: 0, y: 0 };
                    var dis = { x: 0, y: 0 };
                    nowPoint.x = touchC.clientX;
                    nowPoint.y = touchC.clientY;
                    dis.x = nowPoint.x - startPoint.x;
                    dis.y = nowPoint.y - startPoint.y;
                    var translateX = dis.x + elementPoint.x;
                    damu.css(content, "translateX", translateX);
                    if (isFirst) {
                        isFirst = false;
                        if (Math.abs(dis.y) > Math.abs(dis.x)) {
                            isX = false;
                            return;
                        }
                    }
                    jump(dis.x);
                });
                content.addEventListener("touchend", function (ev) {
                    var touchC = ev.changedTouches[0];
                    var nowPoint = { x: 0, y: 0 };
                    var dis = { x: 0, y: 0 };
                    nowPoint.x = touchC.clientX;
                    dis.x = nowPoint.x - startPoint.x;
                    if (Math.abs(dis.x) <= w / 2) {
                        content.style.transition = "2s transform";
                        damu.css(content, "translateX", -w);
                    }
                });

                // 实现拖动时跳转
                function jump(disX) {
                    if (isOver) {
                        return;
                    }
                    if (Math.abs(disX) > w / 2) {
                        isOver = true;
                        content.style.transition = "2s transform";
                        /* if (disX>0) {
                            damu.css(content,"translateX",0);
                        }else{
                            damu.css(content,"translateX",-2*w);
                        } */
                        var targetX = disX > 0 ? 0 : -2 * w;
                        damu.css(content, "translateX", targetX);

                        content.addEventListener("transitionend", endFn);
                        content.addEventListener("webkitTransitionEnd", endFn);

                        function endFn() {
                            // 解绑事件
                            content.removeEventListener("transitionend", endFn);
                            content.removeEventListener("webkitTransitionEnd", endFn);
                            content.style.transition = "none";
                            for (let i = 0; i < loadings.length; i++) {
                                loadings[i].style.opacity = 1;
                            }
                            disX<0 ? now++ : now--;
                            if (now<0) {
                                now=aNodes.length-1;
                            }else if (now>aNodes.length-1) {
                                now=0;
                            }
                            damu.css(smallG,"translateX",aNodes[now].offsetLeft);
                            if (aNodes[now].offsetWidth!=smallG.offsetWidth) {
                                smallG.style.width=aNodes[now].offsetWidth+"px";
                            }
                            setTimeout(function () {
                                for (let i = 0; i < loadings.length; i++) {
                                    loadings[i].style.opacity = 0;
                                }
                                damu.css(content,"translateX",-w);
                            }, 2000);
                        }
                    }
                }
            }
        }

        changeColor();
        // 点击改变导航的颜色
        function changeColor() {
            var list = document.querySelector(".damu-nav-drag-wrapper .list");
            var liNodes = document.querySelectorAll(".damu-nav-drag-wrapper .list > li");
            list.addEventListener("touchstart", function () {
                this.isMove = false;
            });
            list.addEventListener("touchmove", function () {
                this.isMove = true;
            });
            list.addEventListener("touchend", function (ev) {
                if (this.isMove) {
                    return;
                }
                for (let i = 0; i < liNodes.length; i++) {
                    tools.removeClass(liNodes[i], "active");
                }
                if (ev.target.tagName.toUpperCase() == "A") {
                    tools.addClass(ev.target.parentNode, "active");
                } else if (ev.target.tagName.toUpperCase() == "LI") {
                    tools.addClass(ev.target, "active");
                }
            });
        }
        // 点击改变导航的颜色
        /* function changeColor() {
            var liNodes = document.querySelectorAll(".damu-nav-drag-wrapper .list > li");
            for (let i = 0; i < liNodes.length; i++) {
                liNodes[i].addEventListener("touchstart", function () {
                    this.isMove = false;
                });
                liNodes[i].addEventListener("touchmove", function () {
                    this.isMove = true;
                });
                liNodes[i].addEventListener("touchend", function () {
                    if (!this.isMove) {
                        for (let i = 0; i < liNodes.length; i++) {
                            tools.removeClass(liNodes[i], "active");
                        }
                        tools.addClass(this, "active");
                    }
                });
            }
        } */

        swipe();
        // 无缝滑屏
        function swipe() {
            var arr = ['img/1.jpg', 'img/2.jpg', 'img/3.jpg', 'img/4.jpg', 'img/5.jpg']
            damu.carousel(arr)
        }

        drag();
        // 可拖动导航
        function drag() {
            damu.dragNav();
        }

        changeFocus();
        function changeFocus() {
            var inputText = document.querySelector("#wrap .head .head-bottom form input[type='text']");
            inputText.addEventListener("touchstart", function (ev) {
                //获得焦点
                this.focus();
                //阻止冒泡
                ev.stopPropagation();
                //阻止默认行为
                ev.preventDefault();
            })
            document.addEventListener("touchstart", function () {
                //失去焦点
                inputText.blur();
            })
        }

        CMCFMenuBtn();
        // 频道菜单
        function CMCFMenuBtn() {
            var menuBtn = document.querySelector("#wrap .head .head-top .menuBtn");
            var mask = document.querySelector("#wrap .head .mask");
            //isXX为false表示频道按钮
            //isXX为true表示XX按钮
            var isXX = false;
            menuBtn.addEventListener("touchstart", function (ev) {
                var touchC = ev.changedTouches[0];
                if (!isXX) {
                    tools.addClass(menuBtn, "active");
                    mask.style.display = "block";
                } else {
                    tools.removeClass(menuBtn, "active");
                    mask.style.display = "none";
                }
                isXX = !isXX;
                ev.stopPropagation();
                ev.preventDefault();
            })
            document.addEventListener("touchstart", function () {
                if (isXX == true) {
                    tools.removeClass(menuBtn, "active");
                    mask.style.display = "none";
                    isXX = !isXX;
                }
            })
            mask.addEventListener("touchstart", function (ev) {
                ev.stopPropagation();
                ev.preventDefault();
            })
        }
    }
</script>

</html>